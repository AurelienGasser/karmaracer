/*! karmaracer 2013-05-10 */
(function(e){"use strict";$(function(){Karma.Home.start()});var t=function(){function t(){$(".mapLink").click(function(e){return $("#playerNameForm")[0].checkValidity()?(Karma.LocalStorage.set("playerName",$("#playerName").val()),Karma.LocalStorage.set("map",$(this).text()),!0):($("#playerNameForm").find(":submit").click(),e.preventDefault(),!1)})}function n(e){for(var n=$("ul#maps"),a=0;e.length>a;a++){var o=[],s=e[a];o.push('<li id="map-',s,'">'),o.push('<div class="info"><span class="players"/></div>'),o.push('<a class="mapLink" href="game.',s,'" ><div>',s,"</br></div></a>"),o.push("</li>");var r=$(o.join(""));r.hide(),n.append(r),r.fadeIn(1e3),new Karma.MiniMap(r.find("a div"),s,i)}t()}Karma.TopBar.setTopBar();var a=window.location.hostname,i=e.connect(a,{secure:!0});i.emit("get_maps",function(e,t){n(t),$("#loadingImage").fadeOut()}),i.on("maps_state",function(e){var t=function(e){return e.name};for(var n in e){var a=e[n],i=_.map(a.players,t).join(", ");i.length>0&&(i="Playing Now : "+i),$("#map-"+a.map+" .players").html(i)}}),$("#playerNameForm").submit(function(){return!1}),$("#playerName").keyup(function(){Karma.LocalStorage.set("playerName",$(this).val())})};Karma.Home={start:t}})(io);